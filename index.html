<script>
/* ====== STAN GRY ====== */
let totalPoints = parseInt(localStorage.getItem('totalPoints')) || 0;
let clicks = parseInt(localStorage.getItem('clicks')) || 0;
let fastClicks = parseInt(localStorage.getItem('fastClicks')) || 0;
let rebirthCount = parseInt(localStorage.getItem('rebirthCount')) || 0;
let currentNick = localStorage.getItem('currentNick') || "";

let rankingData = JSON.parse(localStorage.getItem('rankingData')) || [];

/* ====== POMOCNICZE ====== */
function getMultiplier() {
  return rebirthCount + 1;
}

function saveGame() {
  localStorage.setItem('totalPoints', totalPoints);
  localStorage.setItem('clicks', clicks);
  localStorage.setItem('fastClicks', fastClicks);
  localStorage.setItem('rebirthCount', rebirthCount);
}

/* ====== LOGIN ====== */
function startGame() {
  const nick = document.getElementById('playerNick').value.trim();
  if (!nick) return alert("Podaj nick");
  currentNick = nick;
  localStorage.setItem('currentNick', nick);
  initGame();
}

function initGame() {
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('gameScreen').style.display = 'block';
  document.getElementById('displayNick').innerText = currentNick;
  updateAllDisplays();
  losujZagadke();
}

/* ====== UI ====== */
function updateAllDisplays() {
  document.getElementById('totalPoints').innerText = totalPoints;
  document.getElementById('clicks').innerText = clicks;
  document.getElementById('fastClicks').innerText = fastClicks;
  document.getElementById('rebirthCount').innerText = rebirthCount;
  updateRanking();
}

/* ====== PUNKTY ====== */
function addPoints(p) {
  totalPoints += p * getMultiplier();
  saveGame();
  updateAllDisplays();
}

/* ====== GRY ====== */
function klik() {
  clicks++;
  addPoints(1);
}

function losuj() {
  const num = Math.floor(Math.random() * 100) + 1;
  document.getElementById('number').innerText = num;
  addPoints(num);
}

document.getElementById('fastClickBtn').addEventListener('click', () => {
  fastClicks++;
  addPoints(5);
  if (fastClicks >= 5) {
    alert("Zaliczone szybkie kliknięcia!");
    fastClicks = 0;
  }
  saveGame();
  updateAllDisplays();
});

function losujKarte() {
  const karty = ["♠A","♥K","♦Q","♣J"];
  document.getElementById('card').innerText =
    karty[Math.floor(Math.random()*karty.length)];
  addPoints(10);
}

function sprawdzLiczbe() {
  const guess = Number(document.getElementById('guessNumber').value);
  const correct = Math.floor(Math.random()*10)+1;
  document.getElementById('guessResult').innerText =
    guess === correct ? "✅ Trafiłeś!" : `❌ Było ${correct}`;
  if (guess === correct) addPoints(20);
}

/* ====== REBIRTH ====== */
function rebirth() {
  if (totalPoints < 100000) {
    alert("Za mało punktów (100 000)");
    return;
  }
  totalPoints = 0;
  rebirthCount++;
  saveGame();
  updateAllDisplays();
  alert(`Rebirth! Mnożnik ×${getMultiplier()}`);
}

/* ====== RANKING ====== */
function updateRanking() {
  const i = rankingData.findIndex(x => x.nick === currentNick);
  if (i >= 0) rankingData[i].points = totalPoints;
  else rankingData.push({nick: currentNick, points: totalPoints});

  rankingData.sort((a,b)=>b.points-a.points);
  document.getElementById('ranking').innerHTML =
    rankingData.slice(0,100).map(p=>`<li>${p.nick} – ${p.points}</li>`).join("");

  localStorage.setItem('rankingData', JSON.stringify(rankingData));
}

/* ====== AUTO LOGIN ====== */
window.onload = () => {
  if (currentNick) initGame();
};
</script>
